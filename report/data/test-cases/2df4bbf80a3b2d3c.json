{"uid":"2df4bbf80a3b2d3c","name":"test_002_oa[case10]","fullName":"test_case.jnt_inter_case.jnt_app.test_debug.TestDebug#test_002_oa","historyId":"981d175c1c951715d0e584d2cc458ab1","time":{"start":1709705645068,"stop":1709705645070,"duration":2},"status":"broken","statusMessage":"UnboundLocalError: local variable 'cursor' referenced before assignment","statusTrace":"self = <pytest_demo.test_case.jnt_inter_case.jnt_app.test_debug.TestDebug object at 0x000001EE28A8D910>\ncase = {'Comment': '', 'ID': 'fukuan_10_c1', 'advice': '', 'case_description': '付款流程_上传附件', ...}\n\n    @allure.step('调试_OA')\n    @pytest.mark.debug\n    # @pytest.mark.parametrize()第一个参数为逗号分隔的字符串列表，第二个参数是值列表parametrize()\n    @pytest.mark.parametrize('case', excel.get_excel_data(\"debug\", \"OA\"))\n    def test_002_oa(self, case):\n        self.d_time.write_time_to_json()\n>       self.new.test_case_method(case)\n\ntest_case\\jnt_inter_case\\jnt_app\\test_debug.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\ncommon\\data_deal.py:253: in test_case_method\n    request_method, expect, api_url, headers, params, global_var, upload_files = self.param_get_deal(case)\ncommon\\data_deal.py:57: in param_get_deal\n    self.single_sql_data_deal(envir, preset_data)  # 返回值都写进json了\ncommon\\data_deal.py:95: in single_sql_data_deal\n    val = oper_s.execute_sql(data)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <common.operate_sql_al.OperateSqlAl object at 0x000001EE28AEE430>\nsql_str = '/data/configId:upload_configId,/data/path:upload_path,/data/url:upload_url,/data/type:upload_type,/data/size:upload_size,/data/wind:upload_wind,/data/windId:upload_windId'\n\n    def execute_sql(self, sql_str):\n        try:\n            db = pymysql.connect(host=self.dbhost, port=self.dbport, user=self.db_user, passwd=self.pwd, db=self.dbname,\n                                 charset='utf8')\n            cursor = db.cursor()  # 创建一个游标\n            cursor.execute(sql_str)\n            data = cursor.fetchone()\n            data = self.bytes_to_str(data[0])\n            return data\n        except Exception:\n            print('\\033[1;33m\"sql执行异常，请检查\"\\033[0m \\n')\n        finally:\n>           cursor.close()\nE           UnboundLocalError: local variable 'cursor' referenced before assignment\n\ncommon\\operate_sql_al.py:83: UnboundLocalError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"init_connect","time":{"start":1709705621607,"stop":1709705621607,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentStep":false,"hasContent":false,"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0}],"testStage":{"status":"broken","statusMessage":"UnboundLocalError: local variable 'cursor' referenced before assignment","statusTrace":"self = <pytest_demo.test_case.jnt_inter_case.jnt_app.test_debug.TestDebug object at 0x000001EE28A8D910>\ncase = {'Comment': '', 'ID': 'fukuan_10_c1', 'advice': '', 'case_description': '付款流程_上传附件', ...}\n\n    @allure.step('调试_OA')\n    @pytest.mark.debug\n    # @pytest.mark.parametrize()第一个参数为逗号分隔的字符串列表，第二个参数是值列表parametrize()\n    @pytest.mark.parametrize('case', excel.get_excel_data(\"debug\", \"OA\"))\n    def test_002_oa(self, case):\n        self.d_time.write_time_to_json()\n>       self.new.test_case_method(case)\n\ntest_case\\jnt_inter_case\\jnt_app\\test_debug.py:39: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\ncommon\\data_deal.py:253: in test_case_method\n    request_method, expect, api_url, headers, params, global_var, upload_files = self.param_get_deal(case)\ncommon\\data_deal.py:57: in param_get_deal\n    self.single_sql_data_deal(envir, preset_data)  # 返回值都写进json了\ncommon\\data_deal.py:95: in single_sql_data_deal\n    val = oper_s.execute_sql(data)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <common.operate_sql_al.OperateSqlAl object at 0x000001EE28AEE430>\nsql_str = '/data/configId:upload_configId,/data/path:upload_path,/data/url:upload_url,/data/type:upload_type,/data/size:upload_size,/data/wind:upload_wind,/data/windId:upload_windId'\n\n    def execute_sql(self, sql_str):\n        try:\n            db = pymysql.connect(host=self.dbhost, port=self.dbport, user=self.db_user, passwd=self.pwd, db=self.dbname,\n                                 charset='utf8')\n            cursor = db.cursor()  # 创建一个游标\n            cursor.execute(sql_str)\n            data = cursor.fetchone()\n            data = self.bytes_to_str(data[0])\n            return data\n        except Exception:\n            print('\\033[1;33m\"sql执行异常，请检查\"\\033[0m \\n')\n        finally:\n>           cursor.close()\nE           UnboundLocalError: local variable 'cursor' referenced before assignment\n\ncommon\\operate_sql_al.py:83: UnboundLocalError","steps":[{"name":"调试_OA","time":{"start":1709705645068,"stop":1709705645069,"duration":1},"status":"broken","statusMessage":"UnboundLocalError: local variable 'cursor' referenced before assignment\n","statusTrace":"  File \"D:\\Program Files\\Python\\Python39\\lib\\site-packages\\allure_commons\\_allure.py\", line 192, in impl\n    return func(*a, **kw)\n  File \"D:\\Scripts\\python_code\\pytest_demo\\test_case\\jnt_inter_case\\jnt_app\\test_debug.py\", line 39, in test_002_oa\n    self.new.test_case_method(case)\n  File \"D:\\Scripts\\python_code\\pytest_demo\\common\\data_deal.py\", line 253, in test_case_method\n    request_method, expect, api_url, headers, params, global_var, upload_files = self.param_get_deal(case)\n  File \"D:\\Scripts\\python_code\\pytest_demo\\common\\data_deal.py\", line 57, in param_get_deal\n    self.single_sql_data_deal(envir, preset_data)  # 返回值都写进json了\n  File \"D:\\Scripts\\python_code\\pytest_demo\\common\\data_deal.py\", line 95, in single_sql_data_deal\n    val = oper_s.execute_sql(data)\n  File \"D:\\Scripts\\python_code\\pytest_demo\\common\\operate_sql_al.py\", line 83, in execute_sql\n    cursor.close()\n","steps":[],"attachments":[],"parameters":[{"name":"case","value":"{'ID': 'fukuan_10_c1', 'case_description': '付款流程_上传附件', 'module': 'OA', 'envir': 'jnt_app_dev', 'pre_case': '', 'request_mode': 'post', 'case_url': '/oa/admin-api/system/file/procedure/upload', 'case_header': '{\"Authorization\":\"Bearer j::oa_token\"}', 'case_global_var': '', 'upload_files': \"{'file': open(r'data/suidao1.jpeg', 'rb')}\", 'case_preset': '/data/configId:upload_configId,/data/path:upload_path,/data/url:upload_url,/data/type:upload_type,/data/size:upload_size,/data/wind:upload_wind,/data/windId:upload_windId', 'case_params': '', 'case_expect': '操作成功', 'Comment': '', 'advice': ''}"}],"attachmentStep":false,"hasContent":true,"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0}],"attachments":[],"parameters":[],"attachmentStep":false,"hasContent":true,"stepsCount":1,"shouldDisplayMessage":true,"attachmentsCount":0},"afterStages":[{"name":"init_connect::0","time":{"start":1709705645173,"stop":1709705645173,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentStep":false,"hasContent":false,"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0}],"labels":[{"name":"feature","value":"调试demo"},{"name":"tag","value":"debug"},{"name":"parentSuite","value":"test_case.jnt_inter_case.jnt_app"},{"name":"suite","value":"test_debug"},{"name":"subSuite","value":"TestDebug"},{"name":"host","value":"WIN-DVMNCVL70K8"},{"name":"thread","value":"25280-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"test_case.jnt_inter_case.jnt_app.test_debug"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"case","value":"{'ID': 'fukuan_10_c1', 'case_description': '付款流程_上传附件', 'module': 'OA', 'envir': 'jnt_app_dev', 'pre_case': '', 'request_mode': 'post', 'case_url': '/oa/admin-api/system/file/procedure/upload', 'case_header': '{\"Authorization\":\"Bearer j::oa_token\"}', 'case_global_var': '', 'upload_files': \"{'file': open(r'data/suidao1.jpeg', 'rb')}\", 'case_preset': '/data/configId:upload_configId,/data/path:upload_path,/data/url:upload_url,/data/type:upload_type,/data/size:upload_size,/data/wind:upload_wind,/data/windId:upload_windId', 'case_params': '', 'case_expect': '操作成功', 'Comment': '', 'advice': ''}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["debug"]},"source":"2df4bbf80a3b2d3c.json","parameterValues":["{'ID': 'fukuan_10_c1', 'case_description': '付款流程_上传附件', 'module': 'OA', 'envir': 'jnt_app_dev', 'pre_case': '', 'request_mode': 'post', 'case_url': '/oa/admin-api/system/file/procedure/upload', 'case_header': '{\"Authorization\":\"Bearer j::oa_token\"}', 'case_global_var': '', 'upload_files': \"{'file': open(r'data/suidao1.jpeg', 'rb')}\", 'case_preset': '/data/configId:upload_configId,/data/path:upload_path,/data/url:upload_url,/data/type:upload_type,/data/size:upload_size,/data/wind:upload_wind,/data/windId:upload_windId', 'case_params': '', 'case_expect': '操作成功', 'Comment': '', 'advice': ''}"]}